#include "LuaAPI.h"
#include "stdint.h"
#include "Sunnet.h"
#include <unistd.h>
#include <string.h>

//开启新服务
int LuaAPI::NewService(lua_State *luaState) {
	//参数个数
	int num = lua_gettop(luaState); //获取参数个数
	//参数1：服务类型
	if(lua_isstring(luaState, 1) == 0) { //1:是  0：不是
		lua_pushinteger(luaState, -1);
		return 1;
	}
	size_t len = 0;
	const char *type = lua_tolstring(luaState, 1, &len);
	char *newstr = new char[len+1]; //后面加\0
	newstr[len] = '\0';
	memcpy(newstr, type, len);
	auto t = std::make_shared<std::string>(newstr);
	//处理
	uint32_t id = Sunnet::inst->NewService(t);
	//返回值
	lua_pushinteger(luaState, id);
	return 1;
}
